<link rel="stylesheet" href="/css/book.css">

<div class="row book">

    <div class="col-sm-5">
        <h3 class="text-center pb-4">SERVICE</h3>
		<div class="d-flex align-items-start">
            <div class="nav flex-column nav-pills me-1" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                <button class="nav-link active" id="v-pills-dog-tab" data-bs-toggle="pill" data-bs-target="#v-pills-dog" type="button" role="tab" aria-controls="v-pills-dog" aria-selected="true">Dog</button>
                <button class="nav-link" id="v-pills-cat-tab" data-bs-toggle="pill" data-bs-target="#v-pills-cat" type="button" role="tab" aria-controls="v-pills-cat" aria-selected="false">Cat</button>
                <button class="nav-link" id="v-pills-other-tab" data-bs-toggle="pill" data-bs-target="#v-pills-other" type="button" role="tab" aria-controls="v-pills-other" aria-selected="false">Other Pets</button>
            </div>
            <div class="tab-content" id="v-pills-tabContent">
                <div class="tab-pane fade show active" id="v-pills-dog" role="tabpanel" aria-labelledby="v-pills-dog-tab">
                    <div class="row service-item p-1" >
                        <div class="col-md-10 px-1">Activity Exercise</div>
                        <div class="col-md-2 px-1 py-0 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add"  id = "Activity Exercise(Dog)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>

                    <div class="row service-item p-1">
                        <div class="col-md-10 px-1">Pet Grooming</div>
                        <div class="col-md-2 px-1 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add" id = "Pet Grooming(Dog)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>

                    <div class="row service-item p-1">
                        <div class="col-md-10 px-1">Pet Boarding</div>
                        <div class="col-md-2 px-1 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add" id = "Pet Boarding(Dog)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>

                    <div class="row service-item p-1">
                        <div class="col-md-10 px-1">Tick Treatments</div>
                        <div class="col-md-2 px-1 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add" id = "Tick Treatments(Dog)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>

                    <div class="row service-item p-1">
                        <div class="col-md-10 px-1">Ear Plucking</div>
                        <div class="col-md-2 px-1 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add" id = "Ear Plucking(Dog)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>
                    <div class="row service-item p-1">
                        <div class="col-md-10 px-1">Sefl-Serve Wash</div>
                        <div class="col-md-2 px-1 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add" id = "Sefl-Serve Wash(Dog)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="v-pills-cat" role="tabpanel" aria-labelledby="v-pills-cat-tab">
                                        <div class="row service-item p-1" >
                        <div class="col-md-10 px-1">Activity Exercise</div>
                        <div class="col-md-2 px-1 py-0 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add"  id = "Activity Exercise(Cat)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>

                    <div class="row service-item p-1">
                        <div class="col-md-10 px-1">Pet Grooming</div>
                        <div class="col-md-2 px-1 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add" id = "Pet Grooming(Cat)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>

                    <div class="row service-item p-1">
                        <div class="col-md-10 px-1">Pet Boarding</div>
                        <div class="col-md-2 px-1 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add" id = "Pet Boarding(Cat)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>

                    <div class="row service-item p-1">
                        <div class="col-md-10 px-1">Tick Treatments</div>
                        <div class="col-md-2 px-1 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add" id = "Tick Treatments(Cat)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>

                    <div class="row service-item p-1">
                        <div class="col-md-10 px-1">Ear Plucking</div>
                        <div class="col-md-2 px-1 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add" id = "Ear Plucking(Cat)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>
                    <div class="row service-item p-1">
                        <div class="col-md-10 px-1">Sefl-Serve Wash</div>
                        <div class="col-md-2 px-1 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add" id = "Sefl-Serve Wash(Cat)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="v-pills-other" role="tabpanel" aria-labelledby="v-pills-other-tab">
                    <div class="row service-item p-1">
                        <div class="col-md-10 px-1">Pet Grooming</div>
                        <div class="col-md-2 px-1 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add" id = "Pet Grooming(Other pets)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>

                    <div class="row service-item p-1">
                        <div class="col-md-10 px-1">Pet Boarding</div>
                        <div class="col-md-2 px-1 d-flex justify-content-center align-items-center">
                            <button type="button" class="btn p-0 btn-add" id = "Pet Boarding(Other Pets)" onClick="reply_click(this.id)">Add</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <form class="col-sm-7 form-book">
	    <h3 class="text-center pb-4">BOOK</h3>

        <div class="row">
            <div class="col-sm-6 form-group">
                <input class="form-control" id="name" name="name" placeholder="Name " type="text" required>
            </div>
            <div class="col-sm-6 form-group">
                <input class="form-control" id="phone" name="phone" placeholder="Phone" type="text" required>
            </div>
        </div>
        <div class="mt-3 form-group row">
            <div class="col-sm-6">
                <input class="form-control" id="email" name="email" placeholder="Email" type="email" required>
            </div>
            <div class="col-sm-6 appointment">
                <input type="datetime-local" class="px-2" id="appointment" name="appointment">
            </div>          
        </div>

        <table class="table mt-3 service-table" name = "serviceTable">
            <thead>
                <tr>
                <th scope="col">#</th>
                <th scope="col" style="width: 60%">Service</th>
                <th scope="col">Amount</th>
                </tr>
            </thead>
            <tbody>
                {{!-- <tr>
                <th scope="row">1</th>
                <td>Grooming</td>
                <td>
                    <div class="buttons_added border-none">
                        <input aria-label="quantity" class="input-qty" max="10" min="0" name="" type="number" value="1">
                    </div>
                </td>
                </tr>
 --}}
            </tbody>
        </table>


        <div>
            <textarea class="form-control mt-3" id="comments" name="note" placeholder="Note" rows="4"></textarea><br>
        </div>
        <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-book" >Book Now</button>
        </div>
    </form>
</div>

<script>
    const elementTbody = document.querySelector('tbody');
    const btnAdd = document.querySelectorAll('.btn-add');

    var listService = []

    const render = () => {
        const html = listService.map((element, index) => (
            `<tr>
            <th scope="row">${index + 1}</th>
            <td>${element.nameService}</td>
            <td>
                <div class="buttons_added border-none">
                    <input aria-label="quantity" class="input-qty" max="10" min="0" type="number" id="${index}" value="${element.amount}" onchange="myFunction(this.value, this.id)">    
                </div>
            </td>
        </tr>`
        ));
        elementTbody.innerHTML = html.join('');
    }

    function reply_click(clicked_id)
    {  
        var b = false;
        listService.forEach((element) => { 
            if(element.nameService == clicked_id){
                b = true;
                if(element.amount < 10){
                    element.amount ++;
                    render();
                }
            } 
        } );
        const Data = {
            nameService: clicked_id,
            amount: "1"
        }
        if(!b){
            listService.push(Data);
            render();
        }
    }

    function myFunction(value, id){
        if(value < 1){
            listService.splice(id, 1);
            render();
        }
        else if(value > 10){
            listService[id].amount = 10;
            render();
        }
        else{
            listService[id].amount = value;
        }
    }


    

    //const formBook = document.querySelector('.form-book');
    const inputName = document.getElementById('name');
    const inputPhone = document.getElementById('phone');
    const inputEmail = document.getElementById('email');
    const inputAppointment = document.getElementById('appointment');
    const inputNote = document.getElementById('comments');
    const btnBook = document.querySelector('.btn-book');
    //const serviceTable = document.querySelector('.service-table');
   // const rows = serviceTable.getElementsByTagName('tr');


    btnBook.addEventListener('click', async ()=>{
        console.log('btn-book clicked');
        var services = [];
        for (i = 0; i < listService.length; i++) {
            console.log(listService[i].amount);
            var service = {
                serviceName: listService[i].nameService,
                type: '',
                quantity: listService[i].amount,
                price: 0,
                total:  0
            }
            console.log(service);
            services.push(service);
        }
        try {
            const name = inputName.value;
            const phone = inputPhone.value;
            const email = inputEmail.value;
            const appointment = inputAppointment.value;
            const note = inputNote.value;

            const res = await fetch('/service/book', {
                method: 'POST',
                body: JSON.stringify({ name, phone, email, appointment, services, note }),
                headers: {'Content-Type': 'application/json'}
            });
            const data = await res.json();
            console.log(data);
            if (data) {
                console.log("DK Thanh Cong");
            }
        }
        catch (err) {
            console.log('sign up error');
            console.log(err);
        }

    });
    

</script>

